<!--<h2>gridStyle: "{{gridStyle}}"</h2>-->
<!-- Start Context Menus -->
<ng-template #sz_dt_header_context_menu let-col>
    <div class="sz-dt-header-context-menu" cdkMenu>
      <button class="header-context-menu-item" cdkMenuItem *ngIf="!isColumnHidden(col.key)" (click)="selectColumn(col.key, false)">Hide Column</button>
      <button class="header-context-menu-item" cdkMenuItem *ngIf="isColumnHidden(col.key)" (click)="selectColumn(col.key, true)">Show Column</button>
      <button class="header-context-menu-item" cdkMenuItem 
        [cdkMenuTriggerFor]="sz_dt_header_column_order_context_menu"
        [cdkMenuTriggerData]="{$implicit: col}"
      >Column Order</button>
      <button class="header-context-menu-item" cdkMenuItem 
      [cdkMenuTriggerFor]="sz_dt_header_row_order_context_menu"
      [cdkMenuTriggerData]="{$implicit: col}">Order By {{col.value}}</button>
    </div>
</ng-template>
<ng-template #sz_dt_header_column_order_context_menu let-col>
    <div class="sz-dt-header-context-menu submenu" cdkMenu>
        <button class="header-context-menu-item" cdkMenuItem (click)="debug(col); moveColumn(col.key, -1)">Move Left</button>
        <button class="header-context-menu-item" cdkMenuItem (click)="debug(col); moveColumn(col.key, +1)">Move Right</button>
        <button class="header-context-menu-item" cdkMenuItem disabled="disabled" (click)="debug(col); moveColumn(col.key, (2 - columnOrder(col.key)))">Send to Front</button>
    </div>
</ng-template>
<ng-template #sz_dt_header_row_order_context_menu let-col> 
    <div class="sz-dt-header-context-menu submenu" cdkMenu>
    <button class="header-context-menu-item" cdkMenuItemRadio 
        [cdkMenuItemChecked]="sortDirection === 'ASC'"
        (cdkMenuItemTriggered)="sortBy(col.key,'ASC')">Ascending</button>
    <button class="header-context-menu-item" cdkMenuItemRadio 
        [cdkMenuItemChecked]="sortDirection === 'DESC'">Decending</button>
    </div>
</ng-template>
<ng-template #sz_dt_cell_context_menu let-data>
    <div class="sz-dt-header-context-menu" cdkMenu>
    <button class="header-context-menu-item" cdkMenuItem (click)="copyCellContent(data.cell, data.cellData)">Copy Cell As JSON</button>
    <button class="header-context-menu-item" cdkMenuItem (click)="copyRowContent(data.row, data.rowData)">Copy Row As JSON</button>
    <!--<button class="header-context-menu-item" cdkMenuItem (click)="minimizeCol(data.col)">Minimize Column</button>-->
    </div>
</ng-template>
<!-- End Context Menus -->
<div class="control-ribbon">
    <!-- start paging component -->
    <sz-cross-source-pager 
        [pageSizeOptions]="[ 10, 25, 50, 75, 100 ]"
        (clearFilters)="clearFilters($event)"
        (sampleClicked)="handleSampleClicked($event)"></sz-cross-source-pager>
    <!-- end paging component -->
    <!-- start column picker component -->
    <div class="column-picker">
        <button class="column-picker-button has-tooltip"
            (click)="toggleColumnPicker($event); $event.stopPropagation()" aria-label="Choose Columns">
            <div class="icon-columns-select mdi--view-column-outline"></div>
            <span class="tooltiptext no-nubbin">Select Columns to display</span>
        </button>
        <div #columnPickerRef class="sz-mat-menu vertical" [class.showing]="showColumnPickerMenu">
            <label class="sz-mat-menu-item" *ngFor="let col of this.selectableColumns | SzOrderedMapEntries; let i = index"
            >{{col.value}}
                <input type="checkbox" 
                [attr.is-checked]="isColumnSelected(col.key)" 
                [checked]="isColumnSelected(col.key)"
                (click)="toggleColumnSelection(col.key, $event)"
                >
                <span class="checkmark" (click)="$event.stopPropagation();"></span>
            </label>
        </div>
    </div>
    <!-- end column picker component -->
</div>

<!--<mat-menu #columnsSelector="matMenu" class="sz-g-flexbox-vertical" yPosition="below" (click)="$event.stopPropagation();">
    <button mat-menu-item *ngFor="let col of this.selectableColumns | SzOrderedMapEntries; let i = index"
    [attr.data-col-order]="columnOrder(col.key)"
    [style.order]="columnOrder(col.key)"
    (click)="$event.stopPropagation();">
    <mat-checkbox [checked]="isColumnSelected(col.key)" (change)="selectColumn(col.key, $event.checked)" (click)="$event.stopPropagation();">{{col.value}}</mat-checkbox>
    </button>
</mat-menu>-->
<!--<button (click)="resetCellSizes()"> reset row cell sizes</button>
<button (click)="getCellSizes()">get row cell sizes</button>-->
<!--<button (click)="getGridColumnSizes()"
sz-tooltip="Tooltip text">Get Grid Column Sizes</button>-->
<!--<button (click)="isColumnHidden2('resolutionRuleCode')">isColumnHidden2('resolutionRuleCode') ? {{isColumnHidden('resolutionRuleCode')}}</button>-->

<table class="data-table data-sample-table" 
    [class.show-all-columns]="showAllColumns"
    [style]="gridStyle" 
    [attr.data-table-index]="resetTableIndexes()">
    <thead>
        <tr style="order: 0">
        <!--<ng-container>-->
            <th 
                #colRef
                *ngFor="let col of this.selectableColumns | SzOrderedMapEntries; let i = index"
                [class]="'sz-dt-column '+cellClass(col.key, 'sz-dt-header','cell')+' '+cellClass(col.key, 'sz-dt','column')" 
                [class.sorted]="isSortedBy(col.key)" 
                [class.sorted-asc]="sortDirection === 'ASC'" 
                [class.sorted-desc]="sortDirection === 'DESC'"
                [class.hidden]="isColumnHidden(col.key)"
                [class.empty-column]="getRowCountForField(col.key) === 0"
                [class.expanded]="isColumnExpanded(col.key)"
                [cdkContextMenuTriggerFor]="sz_dt_header_context_menu"
                [cdkContextMenuTriggerData]="{$implicit: col}"
                [style]="columnStyle(col.key)"
                [attr.data-field-name]="col.key"
                [attr.data-col-order]="columnOrder(col.key)"
                [attr.data-col-value-count]="getRowCountForField(col.key)"
                
                >
                <span class="col-name-text">{{col.value}}</span>
                <div *ngIf="getRowCountForField(col.key) === 0" class="no-data-icon-wrapper has-tooltip">
                    <button class="no-data-icon" mat-icon-button
                        (click)="toggleNoDataLabel(col.key)"
                        ><mat-icon aria-hidden="false" aria-label="toggle column label" fontIcon="info_outline"></mat-icon>
                    </button>
                    <span class="tooltiptext">{{col.value}} is collapsed because no data exists for the displayed records.
                        Click to show or hide the column name placeholder.</span>
                </div>

                <span *ngIf="getRowCountForField(col.key) > 0" class="icon-sort descending mdi--sort-descending" (click)="sortBy(col.key,'DESC')"></span>
                <span *ngIf="getRowCountForField(col.key) > 0" class="icon-sort ascending mdi--sort-ascending" (click)="sortBy(col.key,'ASC')"></span>
                <div *ngIf="getRowCountForField(col.key) > 0" class="handle-resize"
                (mousedown)="onResizeMouseDown(col.key, $event)"
                (mouseup)="onResizeMouseUp(col.key, $event)"></div>
            </th>
            <!--<div class="leftdragbar" onmousedown="startColResize(col.key)" onmouseup="endColResize(col.key)"></div>-->
        <!--</ng-container>-->
        
        </tr>
    </thead>
    <!--<tbody>-->
        <tbody class="row-group" *ngFor="let row of this.data; let groupIndex=index;" 
        #rowRef
        [attr.group-row-index]="groupIndex" 
        [class.hasExpandedCells]="hasExpandedCells(rowRef)"
        [attr.data-source-1]="selectedDataSource1"
        [attr.data-source-2]="selectedDataSource2"
        [class.has-additional-data]="getTotalRowCount(row) !== getRowCountInSelectedDataSources(row)"
        [style]="rowGroupStyle(row)"
        >
            <!--<tr
            [attr.group-record-index]="rI+2" class="row-entity">
                <td #cellRef [attr.data-row-index]="rI+1" *ngFor="let col of this.selectableColumns | SzOrderedMapEntries" 
                    [style]="cellStyle(col.key, getRowId(row, rI+1))"
                    [class]="'sz-dt-cell '+cellClass(col.key, 'sz-dt','cell')+' '+cellClass(col.key, 'sz-dt','column')" 
                    [class.expandable]="isCellExpandable(cellRef)"
                    [class.expanded]="isCellExpanded(cellRef)"
                    [class.hidden]="isColumnHidden(col.key)"
                    [attr.data-cell-height]="getCellHeight(cellRef)"
                    [attr.data-content-height]="getContentHeight(cellRef)"
                    [attr.data-cached-content-height]="getCachedContentHeight(cellRef)"
                    [cdkContextMenuTriggerFor]="sz_dt_cell_context_menu"
                    [cdkContextMenuTriggerData]="{$implicit: {cell: cellRef, row: rowRef, col: col, cellData: row[col.key], rowData: row}}"
                    (click)="onCellClick(col.key, row[col.key], $event, cellRef)">
                    <div class="cell-content" [innerHTML]="cellValue(row[col.key], col.key)" [attr.cell-key]="col.key"></div>
                    <svg xmlns="http://www.w3.org/2000/svg" 
                    height="24" 
                    viewBox="0 -960 960 960" 
                    width="24" 
                    class="min-max-toggle"
                    (click)="toggleCellExpansion(cellRef, getRowId(row, rI+1)); $event.stopPropagation();"
                    ><path d="M440-440v240h-80v-160H200v-80h240Zm160-320v160h160v80H520v-240h80Z"/></svg>
                </td>
            </tr>-->
            <tr
                class="row-entity"
                [attr.data-row-index]="incrementRowCount()"
                [attr.data-source]="row.dataSource"
                >
                <td #cellRef *ngFor="let col of this.selectableColumns | SzOrderedMapEntries"
                    [attr.data-row-index]="getRowIndex()" 
                    [attr.data-cell-order]="getCellOrder(col.key, getRowIndex())"
                    [style]="cellStyle(col.key, getRowIndex())"
                    [class]="'sz-dt-cell '+cellClass(col.key, 'sz-dt','cell')+' '+cellClass(col.key, 'sz-dt','column')" 
                    [class.hidden]="isColumnHidden(col.key)"
                    [class.empty-column]="getRowCountForField(col.key) === 0"
                    [cdkContextMenuTriggerFor]="sz_dt_cell_context_menu"
                    [cdkContextMenuTriggerData]="{$implicit: {cell: cellRef, row: rowRef, col: col, cellData: row[col.key], rowData: row}}"
                    (click)="onCellClick(col.key, row[col.key], $event, cellRef)">
                    <div *ngIf="col.key === 'entityId'" class="cell-content" 
                        matTooltip="Click to view Entity Detail page" 
                        matTooltipPosition="right"
                        [innerHTML]="cellValue(row[col.key], col.key)" [attr.cell-key]="col.key"></div>
                    <div *ngIf="col.key !== 'entityId'" class="cell-content"
                        [innerHTML]="cellValue(row[col.key], col.key)" [attr.cell-key]="col.key"></div>
                    <div *ngIf="col.key === 'entityId' && (getTotalRowCount(row) - getRowCountInSelectedDataSources(row)) > 0">
                        <!-- toggle button -->
                        <button mat-stroked-button class="more-button expanded" 
                            matTooltip="Show additional records from other data sources." 
                            matTooltipPosition="right"
                            (click)="toggleRowExpansion(rowRef); $event.stopPropagation()">{{getTotalRowCount(row) - getRowCountInSelectedDataSources(row)}} Less</button>
                        <button mat-stroked-button class="more-button collapsed" 
                            matTooltip="Show additional records from other data sources." 
                            matTooltipPosition="right"
                            (click)="toggleRowExpansion(rowRef); $event.stopPropagation()">{{getTotalRowCount(row) - getRowCountInSelectedDataSources(row)}} More</button>
                    </div>
                </td>
            </tr>
            <tr *ngFor="let rowQ of row.rows; let recordIndex=index;" 
                [attr.data-row-index]="incrementRowCount()"
                [attr.data-source]="rowQ.dataSource"
                [class.data-source-selected]="isDataSourceSelected(rowQ.dataSource)"
                [class.data-source-not-selected]="!isDataSourceSelected(rowQ.dataSource)"
                class="row-record">
                <td #cellRef [attr.data-record-index]="recordIndex+1" *ngFor="let col of this.selectableColumns | SzOrderedMapEntries" 
                    [attr.data-cell-order]="getCellOrder(col.key, getRowIndex())"
                    [class.no-cell]="col.key === 'entityId'"
                    [class.empty-column]="getRowCountForField(col.key) === 0"
                    [class.hidden]="isColumnHidden(col.key)"
                    [style]="cellStyle(col.key, getRowIndex())"
                    [class]="'sz-dt-cell '+cellClass(col.key, 'sz-dt','cell')+' '+cellClass(col.key, 'sz-dt','column')" 
                    [cdkContextMenuTriggerFor]="sz_dt_cell_context_menu"
                    [cdkContextMenuTriggerData]="{$implicit: {cell: cellRef, row: rowRef, col: col, cellData: rowQ[col.key], rowData: rowQ}}"
                    (click)="onCellClick(col.key, rowQ[col.key], $event, cellRef)"
                >
                    <div class="cell-content" [innerHTML]="cellValue(rowQ[col.key], col.key)" [attr.cell-key]="col.key"></div>
                </td>
            </tr>
            <tr *ngIf="row.relatedEntity" 
                class="row-related-entity"
                [attr.data-row-index]="incrementRowCount()"
                [attr.data-source]="row.relatedEntity.dataSource"
                >
                <td #cellRef *ngFor="let col of this.selectableColumns | SzOrderedMapEntries"
                    [attr.data-row-index]="getRowIndex()" 
                    [attr.data-cell-order]="getCellOrder(col.key, getRowIndex())"
                    [style]="cellStyle(col.key, getRowIndex())"
                    [class]="'sz-dt-cell '+cellClass(col.key, 'sz-dt','cell')+' '+cellClass(col.key, 'sz-dt','column')" 
                    [class.hidden]="isColumnHidden(col.key)"
                    [class.no-cell]="col.key === 'entityId'"
                    [class.empty-column]="getRowCountForField(col.key) === 0"
                    [cdkContextMenuTriggerFor]="sz_dt_cell_context_menu"
                    [cdkContextMenuTriggerData]="{$implicit: {cell: cellRef, row: rowRef, col: col, cellData: row.relatedEntity[col.key], rowData: row.relatedEntity}}"
                    (click)="onCellClick(col.key, row.relatedEntity[col.key], $event, cellRef)">
                        <div class="cell-content" 
                            matTooltip="Click to view Entity Detail page" 
                            matTooltipPosition="above"
                            [innerHTML]="cellValue(row.relatedEntity[col.key], col.key)" [attr.cell-key]="col.key"></div>
                </td>
            </tr>
            <ng-container *ngIf="row.relatedEntity && row.relatedEntity.rows">
                <tr *ngFor="let rowY of row.relatedEntity.rows; let recordIndex=index;" 
                [attr.data-row-index]="incrementRowCount()"
                [attr.data-source]="rowY.dataSource"
                [class.data-source-selected]="isDataSourceSelected(rowY.dataSource)"
                [class.data-source-not-selected]="!isDataSourceSelected(rowY.dataSource)"
                class="row-record row-related-record">
                <td #cellRef [attr.data-record-index]="recordIndex+1" *ngFor="let col of this.selectableColumns | SzOrderedMapEntries" 
                    [attr.data-cell-order]="getCellOrder(col.key, getRowIndex())"
                    [class.no-cell]="col.key === 'entityId'"
                    [class.empty-column]="getRowCountForField(col.key) === 0"
                    [class.hidden]="isColumnHidden(col.key)"
                    [style]="cellStyle(col.key, getRowIndex())"
                    [class]="'sz-dt-cell '+cellClass(col.key, 'sz-dt','cell')+' '+cellClass(col.key, 'sz-dt','column')" 
                    [cdkContextMenuTriggerFor]="sz_dt_cell_context_menu"
                    [cdkContextMenuTriggerData]="{$implicit: {cell: cellRef, row: rowRef, col: col, cellData: rowY[col.key], rowData: rowY}}"
                    (click)="onCellClick(col.key, rowY[col.key], $event, cellRef)"
                >
                    <div class="cell-content" [innerHTML]="cellValue(rowY[col.key], col.key)" [attr.cell-key]="col.key"></div>
                </td>
            </tr>
            </ng-container>
        </tbody>
    <!--</tbody>-->
    </table>